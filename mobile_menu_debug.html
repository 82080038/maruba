<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mobile Menu Click Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .debug-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }
        .debug-header {
            background: #f8f9fa;
            padding: 10px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #dee2e6;
        }
        .status-ok { color: #198754; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
        .status-warning { color: #fd7e14; font-weight: bold; }
        
        /* Mobile sidebar styles */
        .sidebar-test {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            height: 100vh;
            background-color: #212529;
            color: white;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 1045;
            padding: 1rem;
        }
        .sidebar-test.show {
            transform: translateX(0);
        }
        .sidebar-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1040;
        }
        .sidebar-backdrop.show {
            opacity: 1;
            visibility: visible;
        }
        .mobile-toggle {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            align-items: center;
            justify-content: center;
            width: auto;
            height: 40px;
            font-size: 1.25rem;
            padding: 0 12px;
        }
        .nav-link-test {
            color: white !important;
            padding: 8px 12px;
            margin: 2px 0;
            border-radius: 4px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .nav-link-test:hover {
            background-color: rgba(255,255,255,0.1);
        }
        .nav-link-test.clicked {
            background-color: rgba(255,255,255,0.3);
            transform: scale(0.95);
        }
        .debug-result {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }
        .test-button {
            margin: 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .test-button:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">üîç Mobile Menu Click Debug</h1>

        <!-- Test Header -->
        <div class="bg-primary text-white p-3 rounded mb-4">
            <h3>Mobile Menu Test Environment</h3>
            <p>Testing mobile menu item click functionality</p>
            <div class="bg-primary p-3 rounded d-inline-block">
                <button class="btn mobile-toggle" id="mobileSidebarToggle" title="Menu">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="display: block;">
                        <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"></path>
                    </svg>
                    <span class="ms-2" style="font-size: 0.875rem;">MENU</span>
                </button>
            </div>
        </div>

        <!-- Test Sidebar -->
        <div class="sidebar-test" id="mainSidebar">
            <h4>Test Sidebar Menu</h4>
            <ul class="nav nav-pills flex-column mb-auto" id="mainNavigation">
                <li class="nav-item">
                    <a href="#dashboard" class="nav-link nav-link-test" id="navDashboard">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#loans" class="nav-link nav-link-test" id="navLoans">
                        <i class="bi bi-cash-stack"></i> Pinjaman
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#members" class="nav-link nav-link-test" id="navMembers">
                        <i class="bi bi-people"></i> Anggota
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#products" class="nav-link nav-link-test" id="navProducts">
                        <i class="bi bi-box"></i> Produk
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#surveys" class="nav-link nav-link-test" id="navSurveys">
                        <i class="bi bi-clipboard-check"></i> Survei
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#repayments" class="nav-link nav-link-test" id="navRepayments">
                        <i class="bi bi-wallet2"></i> Angsuran
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#reports" class="nav-link nav-link-test" id="navReports">
                        <i class="bi bi-graph-up"></i> Laporan
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#users" class="nav-link nav-link-test" id="navUsers">
                        <i class="bi bi-person-gear"></i> Pengguna
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#audit" class="nav-link nav-link-test" id="navAudit">
                        <i class="bi bi-clock-history"></i> Audit Log
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#letters" class="nav-link nav-link-test" id="navLetters">
                        <i class="bi bi-envelope"></i> Surat-Surat
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#logout" class="nav-link nav-link-test" id="navLogout">
                        <i class="bi bi-box-arrow-right"></i> Logout
                    </a>
                </li>
            </ul>
        </div>

        <!-- Sidebar Backdrop -->
        <div class="sidebar-backdrop" id="sidebarBackdrop"></div>

        <!-- Debug Sections -->
        <div class="debug-section">
            <div class="debug-header">
                <h4>1. Menu Elements Status</h4>
            </div>
            <div id="menuElementsStatus" class="debug-result">Checking...</div>
            <button class="test-button bg-info text-white" onclick="checkMenuElements()">Check Elements</button>
        </div>

        <div class="debug-section">
            <div class="debug-header">
                <h4>2. Event Handlers Status</h4>
            </div>
            <div id="eventHandlersStatus" class="debug-result">Checking...</div>
            <button class="test-button bg-warning text-dark" onclick="checkEventHandlers()">Check Events</button>
        </div>

        <div class="debug-section">
            <div class="debug-header">
                <h4>3. Click Test Results</h4>
            </div>
            <div id="clickTestStatus" class="debug-result">Click menu items to test</div>
            <button class="test-button bg-success text-white" onclick="simulateMenuClicks()">Test All Menu Items</button>
        </div>

        <div class="debug-section">
            <div class="debug-header">
                <h4>4. Navigation Test</h4>
            </div>
            <div id="navigationStatus" class="debug-result">Test navigation functionality</div>
            <button class="test-button bg-primary text-white" onclick="testNavigation()">Test Navigation</button>
        </div>

        <div class="debug-section">
            <div class="debug-header">
                <h4>5. Console Logs</h4>
            </div>
            <div id="consoleStatus" class="debug-result">Open F12 to see console logs</div>
            <button class="test-button bg-dark text-white" onclick="triggerDebugLogs()">Trigger Debug Logs</button>
        </div>

        <div class="debug-section">
            <div class="debug-header">
                <h4>6. Test Results Summary</h4>
            </div>
            <div id="summaryStatus" class="debug-result">Run all tests to get summary</div>
            <button class="test-button bg-success text-white" onclick="runAllTests()">Run All Tests</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global debug variables
        let debugResults = {
            elements: false,
            events: false,
            clicks: false,
            navigation: false
        };

        // Ensure jQuery is loaded before running scripts
        (function($) {
            'use strict';

            $(document).ready(function() {
                console.log('=== Mobile Menu Click Debug Started ===');
                console.log('Window width:', window.innerWidth);
                console.log('jQuery version:', $.fn.jquery);

                // Setup mobile toggle functionality
                setupMobileToggle();

                // Setup menu item click handlers
                setupMenuClickHandlers();

                // Auto-run initial checks
                setTimeout(function() {
                    checkMenuElements();
                    checkEventHandlers();
                }, 500);

                console.log('=== Mobile Menu Click Debug Ready ===');
            });

            function setupMobileToggle() {
                const toggleButton = $('#mobileSidebarToggle');
                const sidebar = $('#mainSidebar');
                const backdrop = $('#sidebarBackdrop');

                console.log('Setting up mobile toggle...');
                console.log('Toggle button found:', toggleButton.length);
                console.log('Sidebar found:', sidebar.length);
                console.log('Backdrop found:', backdrop.length);

                toggleButton.off('click').on('click', function(e) {
                    e.preventDefault();
                    console.log('=== MOBILE TOGGLE CLICKED ===');

                    const isVisible = sidebar.hasClass('show');
                    console.log('Sidebar currently visible:', isVisible);

                    if (isVisible) {
                        sidebar.removeClass('show');
                        backdrop.removeClass('show');
                        console.log('Sidebar hidden');
                    } else {
                        sidebar.addClass('show');
                        backdrop.addClass('show');
                        console.log('Sidebar shown');
                    }

                    // Visual feedback
                    toggleButton.css('background-color', 'rgba(255,255,255,0.3)');
                    setTimeout(function() {
                        toggleButton.css('background-color', 'rgba(255,255,255,0.1)');
                    }, 200);
                });

                // Close sidebar when clicking backdrop
                backdrop.off('click').on('click', function() {
                    sidebar.removeClass('show');
                    backdrop.removeClass('show');
                    console.log('Sidebar closed via backdrop click');
                });

                console.log('Mobile toggle setup complete');
            }

            function setupMenuClickHandlers() {
                console.log('Setting up menu click handlers...');

                // Close sidebar when navigating to a new page
                $('#mainNavigation .nav-link').off('click').on('click', function(e) {
                    e.preventDefault(); // Prevent actual navigation for testing
                    
                    const isMobile = window.innerWidth < 992;
                    const menuText = $(this).text().trim();
                    const menuId = $(this).attr('id');
                    
                    console.log('=== MENU ITEM CLICKED ===');
                    console.log('Menu ID:', menuId);
                    console.log('Menu Text:', menuText);
                    console.log('Mobile mode:', isMobile);
                    console.log('Event target:', e.target);
                    
                    if (isMobile) {
                        // Add visual feedback for mobile menu click
                        $(this).addClass('clicked');
                        setTimeout(() => {
                            $(this).removeClass('clicked');
                        }, 200);
                        
                        // Close sidebar after a short delay for better UX
                        setTimeout(() => {
                            $('#mainSidebar').removeClass('show');
                            $('#sidebarBackdrop').removeClass('show');
                            console.log('Sidebar closed after menu click');
                        }, 150);
                    }
                    
                    // Update active state
                    $('#mainNavigation .nav-link').removeClass('active');
                    $(this).addClass('active');
                    
                    // Log click for debugging
                    $('#clickTestStatus').append('<br><span class="status-ok">‚úÖ Clicked: ' + menuText + ' (Mobile: ' + isMobile + ')</span>');
                    
                    console.log('Menu click handled successfully');
                });

                console.log('Menu click handlers setup complete');
            }

        })(jQuery);

        // Global functions for button clicks
        function checkMenuElements() {
            const status = $('#menuElementsStatus');
            let results = '';

            // Check main navigation
            const mainNav = $('#mainNavigation');
            results += 'Main Navigation: ' + (mainNav.length ? '<span class="status-ok">‚úÖ Found</span>' : '<span class="status-error">‚ùå Missing</span>') + '<br>';

            // Check menu items
            const menuItems = $('#mainNavigation .nav-link');
            results += 'Menu Items: ' + (menuItems.length ? '<span class="status-ok">‚úÖ ' + menuItems.length + ' found</span>' : '<span class="status-error">‚ùå None found</span>') + '<br>';

            // Check specific menu items
            const dashboard = $('#navDashboard');
            const loans = $('#navLoans');
            const logout = $('#navLogout');

            results += 'Dashboard: ' + (dashboard.length ? '<span class="status-ok">‚úÖ Found</span>' : '<span class="status-error">‚ùå Missing</span>') + '<br>';
            results += 'Pinjaman: ' + (loans.length ? '<span class="status-ok">‚úÖ Found</span>' : '<span class="status-error">‚ùå Missing</span>') + '<br>';
            results += 'Logout: ' + (logout.length ? '<span class="status-ok">‚úÖ Found</span>' : '<span class="status-error">‚ùå Missing</span>') + '<br>';

            // Check sidebar
            const sidebar = $('#mainSidebar');
            results += 'Sidebar: ' + (sidebar.length ? '<span class="status-ok">‚úÖ Found</span>' : '<span class="status-error">‚ùå Missing</span>') + '<br>';

            status.html(results);
            debugResults.elements = mainNav.length && menuItems.length > 0 && sidebar.length;
        }

        function checkEventHandlers() {
            const status = $('#eventHandlersStatus');
            let results = '';

            // Check toggle button events
            const toggleButton = $('#mobileSidebarToggle');
            const toggleEvents = $._data(toggleButton[0], 'events');
            const hasToggleClick = toggleEvents && toggleEvents.click && toggleEvents.click.length > 0;

            results += 'Toggle Click Events: ' + (hasToggleClick ? '<span class="status-ok">‚úÖ Attached</span>' : '<span class="status-error">‚ùå Not attached</span>') + '<br>';

            // Check menu item events
            const menuItems = $('#mainNavigation .nav-link');
            let menuEventsAttached = 0;
            menuItems.each(function() {
                const events = $._data(this, 'events');
                if (events && events.click && events.click.length > 0) {
                    menuEventsAttached++;
                }
            });

            results += 'Menu Click Events: ' + (menuEventsAttached === menuItems.length ? '<span class="status-ok">‚úÖ All attached</span>' : '<span class="status-error">‚ùå ' + menuEventsAttached + '/' + menuItems.length + ' attached</span>') + '<br>';

            status.html(results);
            debugResults.events = hasToggleClick && menuEventsAttached === menuItems.length;
        }

        function simulateMenuClicks() {
            console.log('=== SIMULATING ALL MENU CLICKS ===');
            const status = $('#clickTestStatus');
            status.html('<strong>Testing all menu items...</strong><br>');

            const menuItems = $('#mainNavigation .nav-link');
            let clickCount = 0;

            menuItems.each(function(index) {
                const $this = $(this);
                const menuText = $this.text().trim();
                
                setTimeout(() => {
                    console.log('Simulating click on:', menuText);
                    $this.trigger('click');
                    clickCount++;
                    
                    if (clickCount === menuItems.length) {
                        status.append('<br><span class="status-ok">‚úÖ All ' + clickCount + ' menu items clicked</span>');
                        debugResults.clicks = true;
                    }
                }, index * 300); // 300ms delay between clicks
            });
        }

        function testNavigation() {
            console.log('=== TESTING NAVIGATION ===');
            const status = $('#navigationStatus');
            
            // Test window width detection
            const isMobile = window.innerWidth < 992;
            status.html('Window width: ' + window.innerWidth + 'px<br>');
            status.append('Mobile mode: ' + (isMobile ? '<span class="status-ok">YES</span>' : '<span class="status-warning">NO</span>') + '<br>');
            
            // Test sidebar toggle
            const sidebar = $('#mainSidebar');
            const isVisible = sidebar.hasClass('show');
            
            status.append('Sidebar visible: ' + (isVisible ? '<span class="status-ok">YES</span>' : '<span class="status-warning">NO</span>') + '<br>');
            
            // Simulate navigation
            const firstMenu = $('#mainNavigation .nav-link').first();
            if (firstMenu.length) {
                firstMenu.trigger('click');
                status.append('<br><span class="status-ok">‚úÖ Navigation test completed</span>');
                debugResults.navigation = true;
            } else {
                status.append('<br><span class="status-error">‚ùå No menu items to test</span>');
            }
        }

        function triggerDebugLogs() {
            console.log('=== DEBUG CONSOLE LOGS ===');
            console.log('jQuery loaded:', typeof jQuery !== 'undefined');
            console.log('Window width:', window.innerWidth);
            console.log('Is mobile:', window.innerWidth < 992);
            console.log('Toggle button:', $('#mobileSidebarToggle').length);
            console.log('Sidebar:', $('#mainSidebar').length);
            console.log('Menu items:', $('#mainNavigation .nav-link').length);
            console.log('Debug results:', debugResults);

            $('#consoleStatus').html('<span class="status-ok">‚úÖ Debug logs sent to console - check F12</span>');
        }

        function runAllTests() {
            console.log('=== RUNNING ALL TESTS ===');

            checkMenuElements();
            checkEventHandlers();
            testNavigation();

            setTimeout(() => {
                const summary = $('#summaryStatus');
                let results = '<strong>Test Results:</strong><br>';
                results += 'Menu Elements: ' + (debugResults.elements ? '<span class="status-ok">‚úÖ PASS</span>' : '<span class="status-error">‚ùå FAIL</span>') + '<br>';
                results += 'Event Handlers: ' + (debugResults.events ? '<span class="status-ok">‚úÖ PASS</span>' : '<span class="status-error">‚ùå FAIL</span>') + '<br>';
                results += 'Click Tests: ' + (debugResults.clicks ? '<span class="status-ok">‚úÖ PASS</span>' : '<span class="status-warning">‚ö†Ô∏è NOT TESTED</span>') + '<br>';
                results += 'Navigation: ' + (debugResults.navigation ? '<span class="status-ok">‚úÖ PASS</span>' : '<span class="status-error">‚ùå FAIL</span>') + '<br>';

                const allPass = debugResults.elements && debugResults.events && debugResults.navigation;
                results += '<br><strong>Overall: ' + (allPass ? '<span class="status-ok">‚úÖ ALL TESTS PASS</span>' : '<span class="status-error">‚ùå SOME TESTS FAIL</span>') + '</strong>';

                summary.html(results);
                console.log('Test results:', debugResults);
                console.log('All tests pass:', allPass);
            }, 1000);
        }

        // Auto-run summary on page load
        setTimeout(runAllTests, 2000);
    </script>
</body>
</html>
